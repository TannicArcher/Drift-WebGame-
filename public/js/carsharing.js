"undefined"==typeof public&&(public={}),public.carsharing={option:{upd:1e4,speedup:1},init:function(){var a=public.carsharing.option;$('.game-balance-box [data-action="collect"]').on("click",function(){public.carsharing.collect($(this))}),$('[data-path="list"] li').each(function(){var a=Number($(this).attr("data-remove"));if(a<259200){var t=$(this).attr("data-id"),e=$(this).attr("data-level");core.timeout.set(function(){$('[data-path="list"] li[data-id="'+t+'"]').remove(),$('[data-count="'+e+'"]').html(core.main.num(Number($('[data-count="'+e+'"]').html())-1)),$('[data-carsharing="count"]').html(core.main.num(Number($('[data-carsharing="count"]').html())-1))},1e3*a,"remove"+t)}}),core.interval.set(function(){public.carsharing.income()},1e3/a.speedup,"income"),$(".nav.nav-sm.nav-underline.nav-underline-none .nav-item a").on("click",function(){public.carsharing.sort($(this))}),$("body .dt-content .row .taxi-itemcard [data-buy]").on("click",function(){public.carsharing.buy($(this))}),core.timeout.set(function(){public.carsharing.upd()},a.upd,"upd"),$('[data-path="list"] li [data-toggle="popover"]').on("click",function(){var a=$(this).closest("li"),t=a.attr("data-id"),e=Number(a.attr("data-earned-all"));$(".popover .earned-id-"+t).length&&$(".popover .earned-id-"+t).html(core.main.num(e,2,"."))})},sort:function(a){if(a){var r=a.attr("data-sort");if(a.hasClass("active"))if(a.find("i").hasClass("fa-sort-amount-down"))var t="fa-sort-amount-up",o="up";else t="fa-sort-amount-down",o="down";else if("cost"==r)t="fa-sort-amount-down",o="down";else t="fa-sort-amount-up",o="up";a.find("i").removeClass("fa-sort-amount-up fa-sort-amount-down").addClass(t)}else r=(a=$(".nav.nav-sm.nav-underline.nav-underline-none .nav-item a.active")).attr("data-sort");$('[data-path="list"] li').sort(function(a,t){var e=parseInt($(a).attr("data-"+r),10),n=parseInt($(t).attr("data-"+r),10);return"up"==o?e<n?-1:1:n<e?-1:1}).appendTo('[data-path="list"]')},collect:function(a){core.ajax({url:"/carsharing/collect",ident:"collect",preloader:a,success:function(a){if(a&&a.error&&swal({type:"error",text:a.error}),a&&a.balance)for(var t in a.balance)$('[data-balance="'+t+'"]').html(core.main.num(a.balance[t],2,"."));a&&a.success&&($("[data-game-balance]").attr("data-game-balance",0).html("0.0000000"),swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3})({type:"success",title:a.success}))}})},income:function(){var r=totalSecond=0;if($('[data-path="list"] li').each(function(){var a=$(this).attr("data-id"),t=Number($(this).attr("data-second")),e=Number($(this).attr("data-earned"))+t;$(this).attr("data-earned",e);var n=Number($(this).attr("data-earned-all"))+t;$(this).attr("data-earned-all",n),$(".popover .earned-id-"+a).length&&$(".popover .earned-id-"+a).html(core.main.num(n,2,".")),r+=t,totalSecond+=t}),$("[data-carsharing-bonus]").length){var a=Number($("[data-carsharing-bonus]").attr("data-carsharing-bonus"));0<a&&(r+=r*(a/100))}0<r&&(r/=Number(public.carsharing.option.speedup));var t=7;totalSecond&&(totalSecond*=3600,100<totalSecond?t=2:10<totalSecond?t=4:1<totalSecond&&(t=5));var e=Number($("[data-game-balance]").attr("data-game-balance"))+r;$("[data-game-balance]").attr("data-game-balance",e).html(core.main.num(e,t,".","",!1))},buy:function(o){core.ajax({url:"/carsharing/buy/level/"+o.attr("data-buy"),ident:"buy",preloader:o,form:"body .details form",success:function(a){if(a&&a.error&&swal({type:"error",text:a.error}),a&&a.balance)for(var t in a.balance)$('[data-balance="'+t+'"]').html(core.main.num(a.balance[t],2,"."));if(a&&a.success){var e=Number($("[data-carsharing-total-hour]").attr("data-carsharing-total-hour"))+3600*Number(a.data.second);$("[data-carsharing-total-hour]").attr("data-carsharing-total-hour",e).html(core.main.num(e,4,"."));var n=Number($("[data-carsharing-total-hour-speed]").attr("data-carsharing-total-hour-speed"))+3600*Number(a.data.second)+3600*Number(a.data.second)*(Number($("[data-carsharing-bonus]").attr("data-carsharing-bonus"))/100);$("[data-carsharing-total-hour-speed]").attr("data-carsharing-total-hour-speed",n).html(core.main.num(n,4,".")),$('[data-count="'+o.attr("data-buy")+'"]').html(core.main.num(Number($('[data-count="'+o.attr("data-buy")+'"]').html())+1)),$('[data-carsharing="count"]').html(core.main.num(Number($('[data-carsharing="count"]').html())+1));var r='\t\t\t\t\t\t<li class="dt-list__item text-center col" data-id="'+a.data.id+'" data-second="'+a.data.second+'" data-earned="'+a.data.earned+'" data-earned-all="'+a.data["earned-all"]+'" data-remove="'+a.data.remove+'" data-cost="'+a.data.cost+'" data-expires="'+a.data.expires+'" data-datetime="'+a.data.time+'">\t\t\t\t\t\t\t<div class="dt-avatar-wrapper flex-column">\t\t\t\t\t\t\t\t<a class="tl-img" data-placement="bottom" tabindex="0" data-trigger="focus" role="button" data-toggle="popover" title="'+a.data.name+'" data-html="true" data-content="<b>'+lang["income-hour"]+":</b> "+core.main.num(3600*a.data.second,4,".")+" "+lang.rub+"<br><b>"+lang["income-day"]+":</b> "+core.main.num(86400*a.data.second,4,".")+" "+lang.rub+"<br><b>"+lang["income-week"]+":</b> "+core.main.num(604800*a.data.second,4,".")+" "+lang.rub+"<br><b>"+lang["income-month"]+":</b> "+core.main.num(2592e3*a.data.second,4,".")+" "+lang.rub+"<br><b>"+lang["income-car"]+":</b> <span class='earned-id-"+a.data.id+"'>"+core.main.num(a.data["earned-all"],2,".")+"</span> "+lang.rub+"<br><br><b>"+lang.lifetime+":</b> "+a.data.life+"/"+a.data.lifetime+" "+lang.days+"<br><b>"+lang.datetime+":</b> "+a.data.datetime+'"><img src="/public/account/assets/images/items/carsharing-'+o.attr("data-buy")+'.png" class="mb-3 taxi-list-img"></a>\t\t\t\t\t\t\t\t<div class="dt-avatar-info">\t\t\t\t\t\t\t\t\t<span class="dt-avatar-name mb-1 text-nowrap taxi-list-name">'+a.data.name+'</span>\t\t\t\t\t\t\t\t\t<span class="f-12 tl-date" data-toggle="tooltip" data-placement="bottom" data-original-title="'+lang.datetime+'">'+a.data.buyed+"</span>\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</li>\t\t\t\t\t";$('[data-path="list"]').prepend(r),public.carsharing.sort(),$('[data-toggle="popover"]').popover(),swal({type:"success",text:a.success})}a&&a.bonus&&$("[data-carsharing-bonus]").attr("data-carsharing-bonus",a.bonus).html(a.bonus),a&&a.leaders&&a.leaders[1]?$('[data-section="leader"]').html('<a href="/user/'+a.leaders[1]["users-id"]+'" target="_blank">'+a.leaders[1].login+"</a>"):$('[data-section="leader"]').html(lang.empty)}})},upd:function(){var a=public.carsharing.option;core.ajax({url:"/carsharing/upd",ident:"upd",success:function(a){a&&null!=a.bonus&&$("[data-carsharing-bonus]").attr("data-carsharing-bonus")!=a.bonus&&$("[data-carsharing-bonus]").attr("data-carsharing-bonus",a.bonus).html(a.bonus),a&&a.leaders&&a.leaders[1]?$('[data-section="leader"] a').length&&$('[data-section="leader"] a').html()==a.leaders[1].login||$('[data-section="leader"]').html('<a href="/user/'+a.leaders[1]["users-id"]+'" target="_blank">'+a.leaders[1].login+"</a>"):$('[data-section="leader"]').html(lang.empty)},complete:function(){core.timeout.set(function(){public.carsharing.upd()},a.upd,"upd")}})}},$(document).ready(function(){public.carsharing.init()});